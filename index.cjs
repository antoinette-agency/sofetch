"use strict";var R=Object.defineProperty;var v=Object.getOwnPropertyDescriptor;var D=Object.getOwnPropertyNames;var U=Object.prototype.hasOwnProperty;var A=(t,e)=>{for(var r in e)R(t,r,{get:e[r],enumerable:!0})},w=(t,e,r,s)=>{if(e&&typeof e=="object"||typeof e=="function")for(let o of D(e))!U.call(t,o)&&o!==r&&R(t,o,{get:()=>e[o],enumerable:!(s=v(e,o))||s.enumerable});return t};var C=t=>w(R({},"__esModule",{value:!0}),t);var W={};A(W,{SoFetchConfig:()=>c,SoFetchPromise:()=>f,default:()=>I});module.exports=C(W);var c=class{constructor(){this.errorHandlers={};this.beforeSendHandlers=[];this.onRequestCompleteHandlers=[];this.baseUrl=""}catchHTTP(e,r){this.errorHandlers[e]||(this.errorHandlers[e]=[]),this.errorHandlers[e].push(r)}setBasicAuthentication({username:e,password:r}){let o=`Basic ${btoa(`${e}:${r}`)}`;this.beforeSend(h=>{h.headers.Authorization=o})}setBearerToken(e){this.beforeSend(r=>{r.headers.Authorization=`Bearer ${e}`})}setHeaderApiKey({headerName:e,value:r}){this.beforeSend(s=>{s.headers[e]=r})}setQueryStringApiKey({paramName:e,value:r}){this.beforeSend(s=>{let o=new URL(s.url);o.searchParams.append(e,r),s.url=o.toString()})}beforeSend(e){this.beforeSendHandlers.push(e)}onRequestComplete(e){this.onRequestCompleteHandlers.push(e)}};var f=class{constructor(e){this.errorHandlers={};this.beforeSendHandlers=[];this.beforeFetchSendHandlers=[];this.onRequestCompleteHandlers=[];this.timeout=3e4;this.inner=new Promise(e),this.then=this.inner.then.bind(this.inner),this.catch=this.inner.catch.bind(this.inner),this.finally=this.inner.finally.bind(this.inner)}onRequestComplete(e){return this.onRequestCompleteHandlers.push(e),this}beforeSend(e){return this.beforeSendHandlers.push(e),this}beforeFetchSend(e){return this.beforeFetchSendHandlers.push(e),this}catchHTTP(e,r){return this.errorHandlers[e]||(this.errorHandlers[e]=[]),this.errorHandlers[e].push(r),this}async setTimeout(e){return this.timeout=e,this}};function y(t){return new Promise(e=>setTimeout(e,t))}var P=t=>{let{isDefined:e,isArray:r,isFiles:s}=x(t);if(!e)return{};if(!s)return{jsonPayload:t};let o=r?t:[t];return{files:S(o[0])?o:o.map(((n,d)=>({file:n,fieldName:`file${d}`})))}},S=t=>"file"in t&&t.file instanceof File,x=t=>t?Array.isArray(t)?t.length?t[0]instanceof File?{isDefined:!0,isArray:!0,isFiles:!0}:S(t[0])?{isDefined:!0,isArray:!0,isFiles:!0}:{isDefined:!0,isArray:!0,isFiles:!1}:{isDefined:!1,isArray:!0,isFiles:!1}:t instanceof File?{isDefined:!0,isArray:!1,isFiles:!0}:S(t)?{isDefined:!0,isArray:!1,isFiles:!0}:{isDefined:!0,isArray:!1,isFiles:!1}:{isDefined:!1,isArray:!1,isFiles:!1};var g=(t,e)=>{let r=t.status,s=!!(e[r]&&e[r].length);return s&&e[r].forEach(o=>o(t)),s};var b=(t,e)=>(e.forEach(r=>{t=r(t)||t}),t);var T=(t,e)=>(e.forEach(r=>{t=r(t)||t}),t);var N=async({url:t,method:e,body:r,config:s,promise:o})=>{let n={url:t,method:e,body:r,headers:{}};n.url=!s.baseUrl||n.url.startsWith("http")?n.url:`${s.baseUrl}${n.url}`,n=b(n,o.beforeSendHandlers),n=b(n,s.beforeSendHandlers);let{files:d,jsonPayload:p}=P(n.body),m=d?k(n,d):j(n);return m=T(m,o.beforeFetchSendHandlers),{init:m,finalUrl:n.url}},a=(t,e,r,s)=>{let o=new f((h,n)=>{(async()=>{await y(0);let{finalUrl:d,init:p}=await N({url:r,method:e,body:s,config:t,promise:o}),m=new Date().getTime(),l=await Promise.race([fetch(d,p),new Promise((u,F)=>setTimeout(()=>F(new Error("SoFetch timed out")),o.timeout))]),q=new Date().getTime()-m;if(i.verbose&&console.info(`SoFetch: ${e} ${l.status} ${d}`),o.onRequestCompleteHandlers.forEach(u=>{u(l,{duration:q,method:p.method||""})}),t.onRequestCompleteHandlers.forEach(u=>{u(l,{duration:q,method:p.method||""})}),!l.ok){let u=g(l,o.errorHandlers),F=!1;if(u||(F=g(l,t.errorHandlers)),!u&&!F)throw new Error(`Received response ${l.status} from URL ${l.url}`,{cause:l})}let E=await $(l);h(E)})().catch(d=>{n(d)})});return o},j=t=>{let{url:e,method:r,body:s}=t;return t.headers["content-type"]="application/json",{body:s?JSON.stringify(s):void 0,headers:t.headers,method:r,credentials:"include"}},k=(t,e)=>{let{method:r,headers:s}=t,o=new FormData;return e.forEach(n=>{o.append(n.fieldName,n.file,n.file.name)}),{body:o,headers:s,method:r,credentials:"include"}},$=async t=>{if(t.status===203)return;let e=await t.text();if(!e)return;let r=e;try{r=JSON.parse(e)}catch{}return r},i=((t,e)=>a(i.config||new c,e?"POST":"GET",t,e));i.verbose=!1;i.config=new c;i.get=t=>a(i.config,"GET",t);i.post=(t,e)=>a(i.config,"POST",t,e);i.put=(t,e)=>a(i.config,"PUT",t,e);i.patch=(t,e)=>a(i.config,"PATCH",t,e);i.delete=t=>a(i.config,"DELETE",t);i.instance=()=>{let t=new c;t.baseUrl=i.config.baseUrl,t.beforeSendHandlers=[...i.config.beforeSendHandlers],t.onRequestCompleteHandlers=[...i.config.onRequestCompleteHandlers];let e=((r,s)=>a(t,s?"POST":"GET",r,s));return e.get=(r,s)=>a(t,"GET",r,s),e.post=(r,s)=>a(t,"POST",r,s),e.put=(r,s)=>a(t,"PUT",r,s),e.patch=(r,s)=>a(t,"PATCH",r,s),e.delete=(r,s)=>a(t,"DELETE",r,s),e.verbose=i.verbose,e.config=t,e};var H=i;var I=H;0&&(module.exports={SoFetchConfig,SoFetchPromise});
//# sourceMappingURL=index.cjs.map
