"use strict";var R=Object.defineProperty;var v=Object.getOwnPropertyDescriptor;var E=Object.getOwnPropertyNames;var j=Object.prototype.hasOwnProperty;var D=(t,e)=>{for(var r in e)R(t,r,{get:e[r],enumerable:!0})},w=(t,e,r,s)=>{if(e&&typeof e=="object"||typeof e=="function")for(let n of E(e))!j.call(t,n)&&n!==r&&R(t,n,{get:()=>e[n],enumerable:!(s=v(e,n))||s.enumerable});return t};var A=t=>w(R({},"__esModule",{value:!0}),t);var $={};D($,{SoFetchConfig:()=>c,SoFetchPromise:()=>u,default:()=>N});module.exports=A($);var c=class{errorHandlers={};beforeSendHandlers=[];onRequestCompleteHandlers=[];baseUrl="";addHTTPHandler(e,r){this.errorHandlers[e]||(this.errorHandlers[e]=[]),this.errorHandlers[e].push(r)}handleHttpError(e){let r=e.status,s=this.errorHandlers[r]&&this.errorHandlers[r].length;return s&&this.errorHandlers[r].forEach(n=>n(e)),s}setBasicAuthentication({username:e,password:r}){let n=`Basic ${btoa(`${e}:${r}`)}`;this.beforeSend(h=>{h.headers.Authorization=n})}setBearerToken(e){this.beforeSend(r=>{r.headers.Authorization=`Bearer ${e}`})}setHeaderApiKey({headerName:e,value:r}){this.beforeSend(s=>{s.headers[e]=r})}setQueryStringApiKey({paramName:e,value:r}){this.beforeSend(s=>{let n=new URL(s.url);n.searchParams.append(e,r),s.url=n.toString()})}beforeSend(e){this.beforeSendHandlers.push(e)}transformRequest(e){return this.beforeSendHandlers.forEach(r=>{e=r(e)||e}),e}onRequestComplete(e){this.onRequestCompleteHandlers.push(e)}};var u=class extends EventTarget{inner;errorHandlers={};beforeSendHandlers=[];beforeFetchSendHandlers=[];timeout=3e4;then;catch;finally;constructor(e){super(),this.inner=new Promise(e),this.then=this.inner.then.bind(this.inner),this.catch=this.inner.catch.bind(this.inner),this.finally=this.inner.finally.bind(this.inner)}onRequestComplete(e){return this.addEventListener("onRequestSuccess",r=>{e(r.detail)}),this}beforeSend(e){return this.beforeSendHandlers.push(e),this}beforeFetchSend(e){return this.beforeFetchSendHandlers.push(e),this}catchHTTP(e,r){return this.errorHandlers[e]||(this.errorHandlers[e]=[]),this.errorHandlers[e].push(r),this}handleHttpError(e){let r=e.status,s=this.errorHandlers[r]&&this.errorHandlers[r].length;return s&&this.errorHandlers[r].forEach(n=>n(e)),s}transformRequest(e){return this.beforeSendHandlers.forEach(r=>{e=r(e)||e}),e}transformInit(e){return this.beforeFetchSendHandlers.forEach(r=>{e=r(e)||e}),e}async setTimeout(e){return this.timeout=e,this}};function g(t){return new Promise(e=>setTimeout(e,t))}var q=t=>{let{isDefined:e,isArray:r,isFiles:s}=C(t);if(!e)return{};if(!s)return{jsonPayload:t};let n=r?t:[t];return{files:S(n[0])?n:n.map(((d,f)=>({file:d,fieldName:`file${f}`})))}},S=t=>"file"in t&&t.file instanceof File,C=t=>t?Array.isArray(t)?t.length?t[0]instanceof File?{isDefined:!0,isArray:!0,isFiles:!0}:S(t[0])?{isDefined:!0,isArray:!0,isFiles:!0}:{isDefined:!0,isArray:!0,isFiles:!1}:{isDefined:!1,isArray:!0,isFiles:!1}:t instanceof File?{isDefined:!0,isArray:!1,isFiles:!0}:S(t)?{isDefined:!0,isArray:!1,isFiles:!0}:{isDefined:!0,isArray:!1,isFiles:!1}:{isDefined:!1,isArray:!1,isFiles:!1};var a=(t,e,r,s)=>{let n=new u((h,d)=>{(async()=>{let i={url:r,method:e,body:s,headers:{}};i.url=!t.baseUrl||i.url.startsWith("http")?i.url:`${t.baseUrl}${i.url}`,await g(0),i=n.transformRequest(i),i=t.transformRequest(i);let{files:b,jsonPayload:I}=q(i.body),m=b?k(i,b):U(i);m=n.transformInit(m);let T=new Date().getTime(),l=await Promise.race([fetch(i.url,m),new Promise((p,F)=>setTimeout(()=>F(new Error("SoFetch timed out")),n.timeout))]),P=new Date().getTime()-T;if(o.verbose&&console.info(`SoFetch: ${m.method} ${l.status} ${i.url}`),n.dispatchEvent(new CustomEvent("onRequestSuccess",{detail:l})),t.onRequestCompleteHandlers.forEach(p=>{p(l,{duration:P,method:i.method})}),!l.ok){let p=n.handleHttpError(l),F=t.handleHttpError(l);if(!p&&!F)throw new Error(`Received response ${l.status} from URL ${l.url}`,{cause:l})}let y=await x(l);h(y)})().catch(f=>{d(f)})});return n},U=t=>{let{url:e,method:r,body:s}=t;return t.headers["content-type"]="application/json",{body:s?JSON.stringify(s):void 0,headers:t.headers,method:r,credentials:"include"}},k=(t,e)=>{let{method:r,headers:s}=t,n=new FormData;return e.forEach(d=>{n.append(d.fieldName,d.file,d.file.name)}),{body:n,headers:s,method:r,credentials:"include"}},x=async t=>{if(t.status===203)return;let e=await t.text();if(!e)return;let r=e;try{r=JSON.parse(e)}catch{}return r},o=((t,e)=>a(o.config||new c,e?"POST":"GET",t,e));o.verbose=!1;o.config=o.config||new c;o.get=(t,e)=>a(o.config,"GET",t,e);o.post=(t,e)=>a(o.config,"POST",t,e);o.put=(t,e)=>a(o.config,"PUT",t,e);o.patch=(t,e)=>a(o.config,"PATCH",t,e);o.delete=(t,e)=>a(o.config,"DELETE",t,e);o.instance=()=>{let t=new c;t.baseUrl=o.config.baseUrl,t.beforeSendHandlers=[...o.config.beforeSendHandlers],t.onRequestCompleteHandlers=[...o.config.onRequestCompleteHandlers];let e=((r,s)=>a(t,s?"POST":"GET",r,s));return e.get=(r,s)=>a(t,"GET",r,s),e.post=(r,s)=>a(t,"POST",r,s),e.put=(r,s)=>a(t,"PUT",r,s),e.patch=(r,s)=>a(t,"PATCH",r,s),e.delete=(r,s)=>a(t,"DELETE",r,s),e.verbose=o.verbose,e.config=t,e};var H=o;var N=H;0&&(module.exports={SoFetchConfig,SoFetchPromise});
//# sourceMappingURL=index.cjs.map
