"use strict";var R=Object.defineProperty;var v=Object.getOwnPropertyDescriptor;var D=Object.getOwnPropertyNames;var U=Object.prototype.hasOwnProperty;var A=(t,e)=>{for(var r in e)R(t,r,{get:e[r],enumerable:!0})},w=(t,e,r,o)=>{if(e&&typeof e=="object"||typeof e=="function")for(let s of D(e))!U.call(t,s)&&s!==r&&R(t,s,{get:()=>e[s],enumerable:!(o=v(e,s))||o.enumerable});return t};var x=t=>w(R({},"__esModule",{value:!0}),t);var W={};A(W,{SoFetchConfig:()=>c,SoFetchPromise:()=>f,default:()=>I});module.exports=x(W);var c=class{constructor(){this.errorHandlers={};this.beforeSendHandlers=[];this.onRequestCompleteHandlers=[];this.baseUrl=""}catchHTTP(e,r){this.errorHandlers[e]||(this.errorHandlers[e]=[]),this.errorHandlers[e].push(r)}setBasicAuthentication({username:e,password:r}){let s=`Basic ${btoa(`${e}:${r}`)}`;this.beforeSend(h=>{h.headers.Authorization=s})}setBearerToken(e){this.beforeSend(r=>{r.headers.Authorization=`Bearer ${e}`})}setHeaderApiKey({headerName:e,value:r}){this.beforeSend(o=>{o.headers[e]=r})}setQueryStringApiKey({paramName:e,value:r}){this.beforeSend(o=>{let s=new URL(o.url);s.searchParams.append(e,r),o.url=s.toString()})}beforeSend(e){this.beforeSendHandlers.push(e)}onRequestComplete(e){this.onRequestCompleteHandlers.push(e)}};var f=class{constructor(e){this.errorHandlers={};this.beforeSendHandlers=[];this.beforeFetchSendHandlers=[];this.onRequestCompleteHandlers=[];this.timeout=3e4;this.inner=new Promise(e),this.then=this.inner.then.bind(this.inner),this.catch=this.inner.catch.bind(this.inner),this.finally=this.inner.finally.bind(this.inner)}onRequestComplete(e){return this.onRequestCompleteHandlers.push(e),this}beforeSend(e){return this.beforeSendHandlers.push(e),this}beforeFetchSend(e){return this.beforeFetchSendHandlers.push(e),this}catchHTTP(e,r){return this.errorHandlers[e]||(this.errorHandlers[e]=[]),this.errorHandlers[e].push(r),this}async setTimeout(e){return this.timeout=e,this}};function y(t){return new Promise(e=>setTimeout(e,t))}var P=t=>{let{isDefined:e,isArray:r,isFiles:o}=C(t);if(!e)return{};if(!o)return{jsonPayload:t};let s=r?t:[t];return{files:S(s[0])?s:s.map(((n,d)=>({file:n,fieldName:`file${d}`})))}},S=t=>"file"in t&&t.file instanceof File,C=t=>t?Array.isArray(t)?t.length?t[0]instanceof File?{isDefined:!0,isArray:!0,isFiles:!0}:S(t[0])?{isDefined:!0,isArray:!0,isFiles:!0}:{isDefined:!0,isArray:!0,isFiles:!1}:{isDefined:!1,isArray:!0,isFiles:!1}:t instanceof File?{isDefined:!0,isArray:!1,isFiles:!0}:S(t)?{isDefined:!0,isArray:!1,isFiles:!0}:{isDefined:!0,isArray:!1,isFiles:!1}:{isDefined:!1,isArray:!1,isFiles:!1};var g=(t,e)=>{let r=t.status,o=!!(e[r]&&e[r].length);return o&&e[r].forEach(s=>s(t)),o};var b=(t,e)=>(e.forEach(r=>{t=r(t)||t}),t);var T=(t,e)=>(e.forEach(r=>{t=r(t)||t}),t);var N=async({url:t,method:e,body:r,config:o,promise:s})=>{let n={url:t,method:e,body:r,headers:{}};n.url=!o.baseUrl||n.url.startsWith("http")?n.url:`${o.baseUrl}${n.url}`,n=b(n,s.beforeSendHandlers),n=b(n,o.beforeSendHandlers);let{files:d,jsonPayload:p}=P(n.body),m=d?k(n,d):j(n);return m=T(m,s.beforeFetchSendHandlers),{init:m,finalUrl:n.url}},a=(t,e,r,o)=>{let s=new f((h,n)=>{(async()=>{await y(0);let{finalUrl:d,init:p}=await N({url:r,method:e,body:o,config:t,promise:s}),m=new Date().getTime(),l=await Promise.race([fetch(d,p),new Promise((u,F)=>setTimeout(()=>F(new Error("SoFetch timed out")),s.timeout))]),q=new Date().getTime()-m;if(i.verbose&&console.info(`SoFetch: ${e} ${l.status} ${d}`),s.onRequestCompleteHandlers.forEach(u=>{u(l,{duration:q,method:p.method||""})}),t.onRequestCompleteHandlers.forEach(u=>{u(l,{duration:q,method:p.method||""})}),!l.ok){let u=g(l,s.errorHandlers),F=!1;if(u||(F=g(l,t.errorHandlers)),!u&&!F)throw new Error(`Received response ${l.status} from URL ${l.url}`,{cause:l})}let E=await $(l);h(E)})().catch(d=>{n(d)})});return s},j=t=>{let{url:e,method:r,body:o}=t;return t.headers["content-type"]="application/json",{body:o?JSON.stringify(o):void 0,headers:t.headers,method:r}},k=(t,e)=>{let{method:r,headers:o}=t,s=new FormData;return e.forEach(n=>{s.append(n.fieldName,n.file,n.file.name)}),{body:s,headers:o,method:r}},$=async t=>{if(t.status===203)return;let e=await t.text();if(!e)return;let r=e;try{r=JSON.parse(e)}catch{}return r},i=((t,e)=>a(i.config||new c,e?"POST":"GET",t,e));i.verbose=!1;i.config=new c;i.get=t=>a(i.config,"GET",t);i.post=(t,e)=>a(i.config,"POST",t,e);i.put=(t,e)=>a(i.config,"PUT",t,e);i.patch=(t,e)=>a(i.config,"PATCH",t,e);i.delete=t=>a(i.config,"DELETE",t);i.instance=()=>{let t=new c;t.baseUrl=i.config.baseUrl,t.beforeSendHandlers=[...i.config.beforeSendHandlers],t.onRequestCompleteHandlers=[...i.config.onRequestCompleteHandlers];let e=((r,o)=>a(t,o?"POST":"GET",r,o));return e.get=(r,o)=>a(t,"GET",r,o),e.post=(r,o)=>a(t,"POST",r,o),e.put=(r,o)=>a(t,"PUT",r,o),e.patch=(r,o)=>a(t,"PATCH",r,o),e.delete=(r,o)=>a(t,"DELETE",r,o),e.verbose=i.verbose,e.config=t,e};var H=i;var I=H;0&&(module.exports={SoFetchConfig,SoFetchPromise});
//# sourceMappingURL=index.cjs.map
