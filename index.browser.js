var q=Object.defineProperty;var H=(r,t,e)=>t in r?q(r,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):r[t]=e;var n=(r,t,e)=>H(r,typeof t!="symbol"?t+"":t,e);var h=class{constructor(){n(this,"errorHandlers",{});n(this,"beforeSendHandlers",[]);n(this,"onRequestCompleteHandlers",[]);n(this,"baseUrl","")}addHTTPHandler(t,e){this.errorHandlers[t]||(this.errorHandlers[t]=[]),this.errorHandlers[t].push(e)}handleHttpError(t){let e=t.status,s=this.errorHandlers[e]&&this.errorHandlers[e].length;return s&&this.errorHandlers[e].forEach(o=>o(t)),s}setBasicAuthentication({username:t,password:e}){let o=`Basic ${btoa(`${t}:${e}`)}`;this.beforeSend(u=>{u.headers.Authorization=o})}setBearerToken(t){this.beforeSend(e=>{e.headers.Authorization=`Bearer ${t}`})}setHeaderApiKey({headerName:t,value:e}){this.beforeSend(s=>{s.headers[t]=e})}setQueryStringApiKey({paramName:t,value:e}){this.beforeSend(s=>{let o=new URL(s.url);o.searchParams.append(t,e),s.url=o.toString()})}beforeSend(t){this.beforeSendHandlers.push(t)}transformRequest(t){return this.beforeSendHandlers.forEach(e=>{t=e(t)||t}),t}onRequestComplete(t){this.onRequestCompleteHandlers.push(t)}};var f=class extends EventTarget{constructor(e){super();n(this,"inner");n(this,"errorHandlers",{});n(this,"beforeSendHandlers",[]);n(this,"beforeFetchSendHandlers",[]);n(this,"timeout",3e4);n(this,"then");n(this,"catch");n(this,"finally");this.inner=new Promise(e),this.then=this.inner.then.bind(this.inner),this.catch=this.inner.catch.bind(this.inner),this.finally=this.inner.finally.bind(this.inner)}onRequestComplete(e){return this.addEventListener("onRequestSuccess",s=>{e(s.detail)}),this}beforeSend(e){return this.beforeSendHandlers.push(e),this}beforeFetchSend(e){return this.beforeFetchSendHandlers.push(e),this}catchHTTP(e,s){return this.errorHandlers[e]||(this.errorHandlers[e]=[]),this.errorHandlers[e].push(s),this}handleHttpError(e){let s=e.status,o=this.errorHandlers[s]&&this.errorHandlers[s].length;return o&&this.errorHandlers[s].forEach(u=>u(e)),o}transformRequest(e){return this.beforeSendHandlers.forEach(s=>{e=s(e)||e}),e}transformInit(e){return this.beforeFetchSendHandlers.forEach(s=>{e=s(e)||e}),e}async setTimeout(e){return this.timeout=e,this}};function T(r){return new Promise(t=>setTimeout(t,r))}var g=r=>{let{isDefined:t,isArray:e,isFiles:s}=v(r);if(!t)return{};if(!s)return{jsonPayload:r};let o=e?r:[r];return{files:S(o[0])?o:o.map(((d,m)=>({file:d,fieldName:`file${m}`})))}},S=r=>"file"in r&&r.file instanceof File,v=r=>r?Array.isArray(r)?r.length?r[0]instanceof File?{isDefined:!0,isArray:!0,isFiles:!0}:S(r[0])?{isDefined:!0,isArray:!0,isFiles:!0}:{isDefined:!0,isArray:!0,isFiles:!1}:{isDefined:!1,isArray:!0,isFiles:!1}:r instanceof File?{isDefined:!0,isArray:!1,isFiles:!0}:S(r)?{isDefined:!0,isArray:!1,isFiles:!0}:{isDefined:!0,isArray:!1,isFiles:!1}:{isDefined:!1,isArray:!1,isFiles:!1};var l=(r,t,e,s)=>{let o=new f((u,d)=>{(async()=>{let a={url:t,method:r,body:e,headers:{}};a.url=!i.config.baseUrl||a.url.startsWith("http")?a.url:`${i.config.baseUrl}${a.url}`,await T(0),a=o.transformRequest(a),a=i.config.transformRequest(a);let{files:b,jsonPayload:D}=g(a.body),p=b?j(a,b):E(a);p=o.transformInit(p);let c=await Promise.race([fetch(a.url,p),new Promise((F,R)=>setTimeout(()=>R(new Error("SoFetch timed out")),o.timeout))]);if(i.verbose&&console.info(`SoFetch: ${p.method} ${c.status} ${a.url}`),o.dispatchEvent(new CustomEvent("onRequestSuccess",{detail:c})),i.config.onRequestCompleteHandlers.forEach(F=>{F(c)}),!c.ok){let F=o.handleHttpError(c),R=i.config.handleHttpError(c);if(!F&&!R)throw new Error(`Received response ${c.status} from URL ${c.url}`,{cause:c})}let P=await A(c);u(P)})().catch(m=>{d(m)})});return o},E=r=>{let{url:t,method:e,body:s}=r;return r.headers["content-type"]="application/json",{body:s?JSON.stringify(s):void 0,headers:r.headers,method:e,credentials:"include"}},j=(r,t)=>{let{method:e,headers:s}=r,o=new FormData;return t.forEach(d=>{o.append(d.fieldName,d.file,d.file.name)}),{body:o,headers:s,method:e,credentials:"include"}},A=async r=>{if(r.status===203)return;let t=await r.text();if(!t)return;let e=t;try{e=JSON.parse(t)}catch(s){}return e},i=((r,t,e)=>l(t?"POST":"GET",r,t));i.verbose=!1;i.config=i.config||new h;i.get=(r,t)=>l("GET",r,t);i.post=(r,t)=>l("POST",r,t);i.put=(r,t)=>l("PUT",r,t);i.patch=(r,t)=>l("PATCH",r,t);i.delete=(r,t)=>l("DELETE",r,t);i.instance=()=>{let r=((t,e,s)=>l(e?"POST":"GET",t,e));return r.get=(t,e)=>l("GET",t,e),r.post=(t,e)=>l("POST",t,e),r.put=(t,e)=>l("PUT",t,e),r.patch=(t,e)=>l("PATCH",t,e),r.delete=(t,e)=>l("DELETE",t,e),r.verbose=i.verbose,r.config=structuredClone(i.config),r};var y=i;var V=y;export{h as SoFetchConfig,f as SoFetchPromise,V as default};
//# sourceMappingURL=index.browser.js.map
