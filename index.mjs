var u=class{errorHandlers={};beforeSendHandlers=[];constructor(){}baseUrl="";addHTTPHandler(e,r){this.errorHandlers[e]||(this.errorHandlers[e]=[]),this.errorHandlers[e].push(r)}handleHttpError(e){let r=e.status,i=this.errorHandlers[r]&&this.errorHandlers[r].length;return i&&this.errorHandlers[r].forEach(s=>s(e)),i}setBasicAuthentication({username:e,password:r}){let s=`Basic ${btoa(`${e}:${r}`)}`;this.beforeSend(d=>{d.headers.Authorization=s})}setBearerToken(e){this.beforeSend(r=>{r.headers.Authorization=`Bearer ${e}`})}setHeaderApiKey({headerName:e,value:r}){this.beforeSend(i=>{i.headers[e]=r})}setQueryStringApiKey({paramName:e,value:r}){this.beforeSend(i=>{let s=new URL(i.url);s.searchParams.append(e,r),i.url=s.toString()})}beforeSend(e){this.beforeSendHandlers.push(e)}transformRequest(e){return this.beforeSendHandlers.forEach(r=>{e=r(e)||e}),e}};var h=class extends EventTarget{inner;errorHandlers={};beforeSendHandlers=[];beforeFetchSendHandlers=[];timeout=3e4;then;catch;finally;constructor(e){super(),this.inner=new Promise(e),this.then=this.inner.then.bind(this.inner),this.catch=this.inner.catch.bind(this.inner),this.finally=this.inner.finally.bind(this.inner)}onRequestComplete(e){return this.addEventListener("onRequestSuccess",r=>{e(r.detail)}),this}beforeSend(e){return this.beforeSendHandlers.push(e),this}beforeFetchSend(e){return this.beforeFetchSendHandlers.push(e),this}catchHTTP(e,r){return this.errorHandlers[e]||(this.errorHandlers[e]=[]),this.errorHandlers[e].push(r),this}handleHttpError(e){let r=e.status,i=this.errorHandlers[r]&&this.errorHandlers[r].length;return i&&this.errorHandlers[r].forEach(s=>s(e)),i}transformRequest(e){return this.beforeSendHandlers.forEach(r=>{e=r(e)||e}),e}transformInit(e){return this.beforeFetchSendHandlers.forEach(r=>{e=r(e)||e}),e}async setTimeout(e){return this.timeout=e,this}};function b(t){return new Promise(e=>setTimeout(e,t))}var T=t=>{let{isDefined:e,isArray:r,isFiles:i}=P(t);if(!e)return{};if(!i)return{jsonPayload:t};let s=r?t:[t];return{files:F(s[0])?s:s.map(((l,f)=>({file:l,fieldName:`file${f}`})))}},F=t=>"file"in t&&t.file instanceof File,P=t=>t?Array.isArray(t)?t.length?t[0]instanceof File?{isDefined:!0,isArray:!0,isFiles:!0}:F(t[0])?{isDefined:!0,isArray:!0,isFiles:!0}:{isDefined:!0,isArray:!0,isFiles:!1}:{isDefined:!1,isArray:!0,isFiles:!1}:t instanceof File?{isDefined:!0,isArray:!1,isFiles:!0}:F(t)?{isDefined:!0,isArray:!1,isFiles:!0}:{isDefined:!0,isArray:!1,isFiles:!1}:{isDefined:!1,isArray:!1,isFiles:!1};var c=(t,e,r,i)=>{let s=new h((d,l)=>{(async()=>{let n={url:e,method:t,body:r,headers:{}};n.url=!o.config.baseUrl||n.url.startsWith("http")?n.url:`${o.config.baseUrl}${n.url}`,await b(0),n=s.transformRequest(n),n=o.config.transformRequest(n);let{files:S,jsonPayload:E}=T(n.body),m=S?H(n,S):q(n);m=s.transformInit(m);let a=await Promise.race([fetch(n.url,m),new Promise((R,p)=>setTimeout(()=>p(new Error("SoFetch timed out")),s.timeout))]);if(o.verbose&&console.info(`SoFetch: ${m.method} ${a.status} ${n.url}`),s.dispatchEvent(new CustomEvent("onRequestSuccess",{detail:a})),!a.ok){let R=s.handleHttpError(a),p=o.config.handleHttpError(a);if(!R&&!p)throw new Error(`Received response ${a.status} from URL ${a.url}`,{cause:a})}let g=await v(a);d(g)})().catch(f=>{l(f)})});return s},q=t=>{let{url:e,method:r,body:i}=t;return t.headers["content-type"]="application/json",{body:i?JSON.stringify(i):void 0,headers:t.headers,method:r,credentials:"include"}},H=(t,e)=>{let{method:r,headers:i}=t,s=new FormData;return e.forEach(l=>{s.append(l.fieldName,l.file,l.file.name)}),{body:s,headers:i,method:r,credentials:"include"}},v=async t=>{if(t.status===203)return;let e=await t.text();if(!e)return;let r=e;try{r=JSON.parse(e)}catch{}return r},o=((t,e,r)=>c(e?"POST":"GET",t,e));o.verbose=!1;o.config=o.config||new u;o.get=(t,e)=>c("GET",t,e);o.post=(t,e)=>c("POST",t,e);o.put=(t,e)=>c("PUT",t,e);o.patch=(t,e)=>c("PATCH",t,e);o.delete=(t,e)=>c("DELETE",t,e);var y=o;var B=y;export{u as SoFetchConfig,h as SoFetchPromise,B as default};
//# sourceMappingURL=index.mjs.map
